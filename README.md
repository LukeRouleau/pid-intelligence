# PID Intelligence

Intelligent tools for P&ID analysis, featuring a custom Label Studio ML backend for object detection.

## Overview

This repository contains a custom ML backend for Label Studio that generates random bounding box predictions for object detection tasks. The backend is designed to help with labeling images by providing initial predictions that can be adjusted by annotators.

## Prerequisites

- Python 3.11 or higher
- Docker and Docker Compose
- Label Studio (included in requirements.txt)

## Quick Start

### 1. Install Requirements

```bash
# Install all required packages including Label Studio
pip install -r requirements.txt
```

### 2. Create a Project in Label Studio

1. Start Label Studio
   ```bash
   label-studio start
   ```
   By default, Label Studio will be available at http://localhost:8080

2. Open Label Studio in your browser (http://localhost:8080)
3. Sign up or log in
4. Create a new project
5. Choose "Object Detection with Bounding Boxes" as the labeling interface
   - Configure the labels to include some example classes, such as: "person", "car", "bicycle", "motorcycle"
   - These will be replaced by your actual classes once you implement your real object detection model
6. Save the project

### 3. Get Your Label Studio API Key

1. In Label Studio, click on your user icon in the top-right corner
2. Go to "Account & Settings"
3. Navigate to the "Access Token" tab
4. Click "Create" to generate a new token
5. **Important**: Copy and save this token securely, as it will only be shown once

### 4. Set Up the ML Backend

#### Create a .env File

Create a `.env` file in the `pid-intel-label-studio-ml-backend/my_ml_backend` directory with the following content:

```
LABEL_STUDIO_URL=http://YOUR_IP_ADDRESS:8080
LABEL_STUDIO_API_KEY=YOUR_API_KEY
```

Replace:
- `YOUR_IP_ADDRESS` with your machine's IP address (not localhost or 127.0.0.1)
  - On Windows: Find your IP using `ipconfig` in Command Prompt
  - On macOS/Linux: Find your IP using `ifconfig` in Terminal
- `YOUR_API_KEY` with the API key you generated in the previous step

#### Start the ML Backend with Docker

```bash
cd pid-intel-label-studio-ml-backend/my_ml_backend
docker-compose up
```

The ML backend will be available at http://localhost:9090

### 5. Connect the ML Backend to Label Studio

1. In Label Studio, go to your project
2. Navigate to "Settings" > "Machine Learning"
3. Click "Add Model"
4. Enter the URL of your ML backend: http://localhost:9090
5. Click "Validate and Save"
6. After saving, verify that the model appears in the list of connected models with a green "Connected" status

### 6. Import Images and Start Labeling

1. In your Label Studio project, go to "Data Import"
2. Upload your images
3. Start labeling - you should see random bounding box predictions generated by the ML backend

## How It Works

The custom ML backend:

1. Receives image data from Label Studio
2. Generates 2-4 random bounding boxes with random classes
3. Returns these predictions to Label Studio
4. The predictions appear as pre-annotations that can be adjusted by annotators

The ML backend is a mock implementation that generates random predictions. In a real-world scenario, you would replace the random generation with actual object detection model inference.

## Troubleshooting

- **Connection Issues**: If the ML backend cannot connect to Label Studio, ensure that:
  - The IP address in `LABEL_STUDIO_URL` is correct
  - Label Studio is running
  - There are no firewall rules blocking the connection

- **Docker Issues**: If you encounter Docker-related errors:
  - Ensure Docker and Docker Compose are installed and running
  - Try restarting the Docker daemon
  - Check Docker logs for more detailed error messages
  - Try updating your Docker Engine settings by going to Docker Desktop > Settings > Docker Engine and replacing the JSON with:
    ```json
    {
      "builder": {
        "gc": {
          "defaultKeepStorage": "20GB",
          "enabled": true
        }
      },
      "experimental": false,
      "features": {
        "buildkit": false
      }
    }
    ```
    Then click "Apply & Restart"

- **Prediction Issues**: If you don't see predictions in Label Studio:
  - Check that the ML backend is properly connected in the project settings
  - Verify that the labeling configuration matches the expected format in the ML backend
  - Check the ML backend logs for any errors